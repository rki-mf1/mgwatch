{% extends "mgw_api/base.html" %}

{% block title %}Result Files!{% endblock %}

{% block content %}

<div class="result-table">
    <h2>{{ result.name }}</h2>
    <a href="{% url 'mgw_api:list_result' %}">Back to Results</a>
    <form id="watch-form" method="post" action="{% url 'mgw_api:toggle_watch' result.pk %}">
        {% csrf_token %}
        <label>
            <input type="checkbox" name="is_watched" {% if result.is_watched %}checked{% endif %} onchange="submitWatchForm()">
            Watched
        </label>
    </form>
    <a href="{% url 'mgw_api:delete_result' result.pk %}?next={% url 'mgw_api:result_table' result.pk %}">Delete this Result</a>
    
    <form method="get" id="filter-form">
        {{ form.as_p }}
        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        {% for header in headers %}
                            <th>
                                <button type="submit" name="sort_column" value="{{ forloop.counter0 }}"
                                    formaction="?sort_column={{ forloop.counter0 }}&sort_order={% if request.GET.sort_column == forloop.counter0|stringformat:'d' and request.GET.sort_order == 'asc' %}desc{% else %}asc{% endif %}">
                                    {{ header }}
                                    {% if request.GET.sort_column == forloop.counter0|stringformat:'d' %}
                                        {% if request.GET.sort_order == 'asc' %}▲{% else %}▼{% endif %}
                                    {% endif %}
                                </button>
                            </th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for row in rows %}
                        <tr>
                            {% for cell in row %}
                                <td>{{ cell }}</td>
                            {% endfor %}
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <button type="submit">Apply Filters</button>
    </form>
</div>

<script>
function submitWatchForm() {
    const form = document.getElementById('watch-form');
    const formData = new FormData(form);

    fetch(form.action, {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
        },
        body: formData,
    }).then(response => {
        if (!response.ok) {
            alert('Failed to update the watch status.');
        }
    });
}
</script>

{% endblock %}








